<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Reçu de Paiement – 1ère édition des Journées Scientifiques de l’INERA – 2025</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.08); }
    h1, h2 { text-align: center; margin: 5px 0; }
    label { font-weight:bold; font-size: 14px; }
    input, select { width: 100%; padding: 10px; margin: 6px 0 14px 0; border-radius:6px; border:1px solid #ccc; }
    button { padding: 12px; width: 100%; margin-top: 8px; border-radius: 8px; cursor: pointer; border:none; font-weight:bold; }
    button.generate { background: #005b96; color: #fff; }
    button.print { background: #000; color: #fff; }
    .receipt { display: none; margin-top: 35px; border: 2px dashed #000; padding: 20px; }
    .receipt-header { text-align:center; margin-bottom:15px; }
    .row { display:flex; justify-content:space-between; font-size:14px; margin: 4px 0; }
    .row span.label { font-weight:bold; }
    .stamp { margin-top: 30px; text-align: center; }
    .stamp img { max-height:80px; opacity:0.95; }
    .upload-block { margin-bottom: 15px; padding:10px; background:#f9f9f9; border-radius:8px; }
    @media print {
      body { background: #fff; padding: 0; }
      .container { box-shadow:none; border-radius:0; max-width:100%; }
      button, .upload-block { display:none; }
    }
  </style>
</head>
<body>
<div class="container">

  <div class="upload-block">
    <label>Importer le logo INERA</label>
    <input type="file" accept="image/*" onchange="loadLogo(event)">

    <label>Importer le cachet électronique</label>
    <input type="file" accept="image/*" onchange="loadStamp(event)">
  </div>

  <h1>INERA</h1>
  <h2>1ère édition des Journées Scientifiques de l’INERA – 2025</h2>

  <div id="formBlock" style="margin-top:20px;">
    <label>Nom du participant</label>
    <input type="text" id="name" placeholder="Nom et prénom" />

    <label>Structure</label>
    <input type="text" id="structure" placeholder="Institution / Service / Laboratoire" />

    <label>Motif de paiement</label>
    <select id="motif">
      <option value="Communication orale">Communication orale</option>
      <option value="Poster">Poster</option>
    </select>

    <label>Mode de paiement</label>
    <select id="mode">
      <option value="Orange Money">Orange Money</option>
      <option value="Western Union">Western Union</option>
    </select>

    <label>Référence de transaction</label>
    <input type="text" id="reference" placeholder="Numéro de transaction" required />

    <label>Montant</label>
    <select id="amount">
      <option value="10000">10 000 FCFA</option>
      <option value="20000">20 000 FCFA</option>
      <option value="25000">25 000 FCFA</option>
      <option value="30000">30 000 FCFA</option>
      <option value="50000">50 000 FCFA</option>
      <option value="75000">75 000 FCFA</option>
    </select>

    <button class="generate" id="btnGenerate" onclick="generate()">Générer le reçu</button>
    <button class="print" onclick="window.print()">Télécharger / Imprimer en PDF</button>
  </div>

  <div class="receipt" id="receipt">
    <div class="receipt-header">
      <div id="logoReceipt"></div>
      <h2>REÇU DE PAIEMENT</h2>
      <p><strong>INERA</strong></p>
      <p style="font-size:14px;">1ère édition des Journées Scientifiques – 2025</p>
    </div>
    <div class="row"><span class="label">N° Reçu :</span><span id="r_num"></span></div>
    <div class="row"><span class="label">Nom :</span><span id="r_name"></span></div>
    <div class="row"><span class="label">Structure :</span><span id="r_structure"></span></div>
    <div class="row"><span class="label">Motif :</span><span id="r_motif"></span></div>
    <div class="row"><span class="label">Mode de paiement :</span><span id="r_mode"></span></div>
    <div class="row"><span class="label">Référence :</span><span id="r_reference"></span></div>
    <div class="row"><span class="label">Montant :</span><span id="r_amount"></span><span>&nbsp;FCFA</span></div>
    <div class="row"><span class="label">Date :</span><span id="r_date"></span></div>

    <div style="margin-top:40px; text-align:right; font-size:14px;">
      <p><strong>Le Trésorier / Responsable</strong></p>
      <br><br>
      <p>Signature</p>
    </div>

    <div id="stampReceipt" class="stamp"></div>
  </div>
</div>

<script>
  let compteur = parseInt(localStorage.getItem("compteur_recu_inera") || "0");
  let logoDataUrl = null;
  let stampDataUrl = null;

  let usedRefs = [];
  try {
    usedRefs = JSON.parse(localStorage.getItem("recu_inera_refs") || "[]");
  } catch(e) {
    usedRefs = [];
  }

  function loadLogo(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      logoDataUrl = e.target.result;
      document.getElementById("logoReceipt").innerHTML = `<img src="${logoDataUrl}" style="max-height:80px;" alt="Logo INERA">`;
    };
    reader.readAsDataURL(file);
  }

  function loadStamp(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      stampDataUrl = e.target.result;
    };
    reader.readAsDataURL(file);
  }

  function generate() {
    const ref = document.getElementById("reference").value.trim();
    const name = document.getElementById("name").value.trim();

    if (!ref) {
      alert("Veuillez renseigner la référence de transaction avant de générer le reçu.");
      return;
    }
    if (!name) {
      alert("Veuillez renseigner le nom du participant.");
      return;
    }

    const key = ref.toLowerCase();

    if (usedRefs.includes(key)) {
      alert("Un reçu a déjà été généré pour cette référence de transaction. Vous ne pouvez pas le régénérer.");
      document.getElementById("btnGenerate").disabled = true;
      return;
    }

    usedRefs.push(key);
    localStorage.setItem("recu_inera_refs", JSON.stringify(usedRefs));

    compteur++;
    localStorage.setItem("compteur_recu_inera", String(compteur));

    document.getElementById("receipt").style.display = "block";
    document.getElementById("r_name").innerText = name;
    document.getElementById("r_structure").innerText = document.getElementById("structure").value;
    document.getElementById("r_motif").innerText = document.getElementById("motif").value;
    document.getElementById("r_mode").innerText = document.getElementById("mode").value;
    document.getElementById("r_reference").innerText = ref;
    document.getElementById("r_amount").innerText = document.getElementById("amount").value;
    document.getElementById("r_num").innerText = compteur;
    document.getElementById("r_date").innerText = new Date().toLocaleDateString('fr-FR');

    if (stampDataUrl) {
      document.getElementById("stampReceipt").innerHTML = `<img src="${stampDataUrl}" alt="Cachet électronique INERA">`;
    }

    document.getElementById("formBlock").style.display = "none";
  }
</script>
</body>
</html>
